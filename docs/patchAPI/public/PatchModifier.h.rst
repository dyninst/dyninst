.. _`sec:PatchModifier.h`:

PatchModifier.h
###############

.. cpp:namespace:: Dyninst::PatchAPI

.. cpp:class:: PatchModifier

  **Interface for user-triggered modification of a PatchAPI CFG**

  This includes abstract capabilities such as replacing a function or low-level
  capabilities like splitting blocks or redirecting edges.

  .. cpp:function:: static bool redirect(PatchEdge *edge, PatchBlock *target)

      Set the target of the existing edge, ``edge``, to ``target``.

      If target is ``NULL``, user is requesting a redirect to the sink block.

  .. cpp:function:: static PatchBlock* split(PatchBlock* b, Address addr, bool trust = false, Address newlast = (Address)-1)

      Splits the block ``b``, creating a new block starting at ``addr``.

      If ``trust`` is enabled, ``addr`` is not checked to be a valid instruction address.
      If ``newlast`` is not -1, it is used as the last instruction address of the
      first block. All points are updated to belong to the appropriate block.

      Returns the created block.

  .. cpp:function:: static bool remove(std::vector<PatchBlock *> &blocks, bool force = false)

      Remove the blocks, ``blocks`` from the CFG.

      The block must be unreachable (that is, have no in-edges) unless ``force`` is ``true``.

  .. cpp:function:: static bool remove(PatchFunction* f)

      Removes the function ``f`` and all of its **unshared** blocks.

  .. cpp:function:: static InsertedCode::Ptr insert(PatchObject* o, SnippetPtr snip, Point* point)

      Inserts the snippet ``snip`` into the object ``o`` at point ``point``.

      Returns the inserted code block.

  .. cpp:function:: static InsertedCode::Ptr insert(PatchObject* o, void* start, unsigned size)

      Inserts the ``size`` bytes from ``start`` into the first free address in object ``o``.

      Returns the inserted code block.

.. cpp:class:: InsertedCode

  **A CFG subgraph generated by inserting new code**

  The graph has a single entry point and multiple exits, represented by
  edges to the sink node.

  .. cpp:type:: boost::shared_ptr<InsertedCode> Ptr

  .. cpp:function:: InsertedCode()
  .. cpp:function:: PatchBlock* entry()
  .. cpp:function:: const std::vector<PatchEdge*> &exits()
  .. cpp:function:: const std::set<PatchBlock*> &blocks()

