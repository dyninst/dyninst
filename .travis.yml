language: cpp

sudo: false

addons:
    apt:
        sources:
            - kalakris-cmake
        packages:
            - binutils-dev
            - cmake
            - libboost-system-dev
            - libboost-thread-dev
            - libelf-dev

env:
    global:
        - DYNINSTAPI_RT_LIB=$HOME/install/lib/libdyninstAPI_RT.so
        - DYNINST_DEBUG_STARTUP=1
        - PATH=$PATH:$HOME/install/bin

compiler:
    - gcc

before_script:
    - git clone --depth 1 git://github.com/dyninst/testsuite

script:
    - mkdir work
    - cd work
    - cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/install
    - make -j2
    - make install
    - cd ../testsuite
    - mkdir work
    - cd work
    - cmake .. -DDyninst_DIR=$HOME/install/lib/cmake/Dyninst -DCMAKE_INSTALL_PREFIX=$HOME/install
    - make -j2
    - make install
    - $HOME/install/bin/testsuite/runTests -all -log -verbose
